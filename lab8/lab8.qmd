---
title: "Практическая работа №8"
author: "yaroslavprishedko@yandex.ru"
format: 
  md:
    output-file: README.md
---

## Цель работы

1.  Изучить возможности технологии Yandex DataLens для визуального анализа структурированных наборов данных
2.  Получить навыки визуализации данных для последующего анализа с помощью сервисов Yandex Cloud
3.  Получить навыки создания решений мониторинга/SIEM на базе облачных продуктов и открытых программных решений
4.  Закрепить практические навыки использования SQL для анализа данных сетевой активности в сегментированной корпоративной сети

## Исходные данные

1.  Программное обеспечение MacOS Version 15.7.1 (24G231)
2.  RStudio Desktop
3.  Интерпретатор языка R 4.5.2
4.  Yandex Query Language

## Задание

Используя сервис Yandex DataLens настроить доступ к Yandex Query, который Вы использовали в ходе ранее выполненных практических работ, и визуально представить результаты анализа данных.

## План

1. Настроить интеграцию Yandex Query с DataLens.
  1.1. Создать новое подключение
  1.2. Выбрать подключение с типом Yandex Query
2. Реализовать DataLens датасет на основе данных из YQ-подключения
3. Реализовать три чарта
  3.1. Круговая диаграмма "Среднего размера пакета"
  3.2. Столбчатая диаграмма "Топ самых популярных портов" (по количеству записей)
  3.3. Столбчатая диаграмма "Обнаружение IP с аномальной активностью"
4. Составить единый дашборд со всеми чартами.

## Шаги:

### Шаг 1. Настроить интеграцию Yandex Query с DataLens

Перейдем в сервис Yandex Datalens:

![](./images/image1.png)

#### Шаг 1.1. Создать новое подключение

Страница с выбором типов подключения:

![](./images/image2.png)

#### Шаг 1.2. Выбрать подключение с типом Yandex Query

Создание нового подключения: 

![](./images/image3.png)

### Шаг 2. Реализовать DataLens датасет на основе данных из YQ-подключения

Импорт данных из YQ-подключения в датасет в виде таблицы:

![](./images/image4.png)

### Шаг 3. Реализовать три чарта

Страница создания чарта:

![](./images/image5.png)

#### Шаг 3.1. Круговая диаграмма "Среднего размера пакета"

Вычисляемое поле: `packet_size_category`

```
IF 
    [bytes] = 0 
        THEN 'Пустые (0 байт)'
ELSEIF 
    [bytes] < 64 
        THEN 'Минимальные (<64 байт)'
ELSEIF 
    [bytes] < 128 
        THEN 'Очень маленькие (64-127 байт)'
ELSEIF 
    [bytes] < 256 
        THEN 'Маленькие (128-255 байт)'
ELSEIF 
    [bytes] < 512 
        THEN 'Средне-маленькие (256-511 байт)'
ELSEIF 
    [bytes] < 1024 
        THEN 'Средние (<1KB)'
ELSEIF 
    [bytes] < 2048 
        THEN 'Средне-большие (1KB-2KB)'
ELSEIF 
    [bytes] < 10240 
        THEN 'Большие (2KB-10KB)'
ELSEIF 
    [bytes] < 51200 
        THEN 'Очень большие (10KB-50KB)'
ELSEIF 
    [bytes] < 102400 
        THEN 'Крупные (50KB-100KB)'
ELSEIF 
    [bytes] < 524288 
        THEN 'Значительные (100KB-512KB)'
ELSEIF 
    [bytes] < 1048576 
        THEN 'Большие файлы (512KB-1MB)'
ELSEIF 
    [bytes] < 10485760 
        THEN 'Крупные файлы (1MB-10MB)'
ELSEIF 
    [bytes] < 104857600 
        THEN 'Очень крупные (10MB-100MB)'
ELSE 
    'Гигантские (>100MB)'
END
```

Добавление метрики:

![](./images/image6.png)

Результат визуализации чарта:

![](./images/image7.png)

#### Шаг 3.2. Столбчатая диаграмма "Топ самых популярных портов" (по количеству записей)

Вычисляемое поле: `amount_of_ports`

```
COUNT([port])
```

Добавление метрики:

![](./images/image8.png)

Сортировка: По убыванию количества записей (по убыванию метрики amount_of_ports)

Результат визуализации чарта:

![](./images/image9.png)

#### Шаг 3.3. Столбчатая диаграмма "Обнаружение IP с аномальной активностью"

Добавим ряд вычисляемых полей:

`connection_count:`

```
CONCAT([src], '-', [dst], '-', STR(HOUR([timestamp])))
```

`connection_frequency:`

```
IF [bytes] < 1000
    THEN 'редкие'
ELSEIF [bytes] >= 1000 AND [bytes] < 10000
    THEN 'умеренные'
ELSEIF [bytes] >= 10000 AND [bytes] < 100000
    THEN 'частые'
ELSE
    'очень частые'
END
```

`port_risk_category:`

```
IF [port] = 22 OR [port] = 23 OR [port] = 3389
    THEN 'высокий риск'
ELSEIF [port] = 80 OR [port] = 443
    THEN 'нормальный'
ELSEIF [port] >= 1024 AND [port] <= 65535
    THEN 'динамический'
ELSE
    'другой'
END
```

`activity_level:`

```
IF [connections_per_hour] >= 1 AND [connections_per_hour] <= 5
    THEN 'низкая'
ELSEIF [connections_per_hour] >= 6 AND [connections_per_hour] <= 20
    THEN 'средняя'
ELSEIF [connections_per_hour] >= 21 AND [connections_per_hour] <= 100
    THEN 'высокая'
ELSEIF [connections_per_hour] > 100
    THEN 'очень высокая'
ELSE
    'неизвестно'
END
```

Полученный набор вычисляемых полей:

![](./images/image10.png)

Итоговый чарт, показывающий IP с аномальной активностью:

![](./images/image11.png)

### Шаг 4. Составить единый дашборд со всеми чартами.

Добавим чарты в дашборд, так выглядит добавление:

![](./images/image12.png)

Итоговый дашборд:

![](./images/image13.png)

[Ссылка на дашборд](https://datalens.yandex/fzgxghapc0emz)

## Оценка результата

В рамках выполнения данной практической работы была изучена возможность применения технологии Yandex Datalens для проведения анализа данных сетевой активности.

## Вывод

В процессе выполнения практической работы мы освоили функциональные возможности сервисов Yandex Datalens, научились применять их для визуализации данных, а также получили практические навыки построения различных типов диаграмм и разработке персональных дашбордов.