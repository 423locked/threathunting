---
title: "Практическая работа №3. Основы обработки данных с помощью R и Dplyr"
author: "yaroslavprishedko@yandex.ru"
format: 
  md:
    output-file: README.md
---

## Цель работы

1.  Развить практические навыки использования языка программирования R для обработки данных
2.  Закрепить знания базовых типов данных языка R
3.  Развить практические навыки использования функций обработки данных пакета `dplyr` – функции `select()`, `filter()`, `mutate()`, `arrange()`, `group_by()`

## Исходные данные

1.  Программное обеспечение MacOS Version 15.7.1 (24G231)
2.  RStudio Desktop
3.  Интерпретатор языка R 4.5.2
4.  Пакеты `nycflights13` и `dplyr`

## Задание

Используя программный пакет `dplyr`, проанализировать встроенные в пакет `nycflights13` наборы данных с помощью языка `R` и ответить на вопросы.

## Ход работы

1.  Проанализировать встроенные в пакет nycflights13 наборы данных с помощью языка R и ответить на вопросы:
    -   Сколько встроенных в пакет nycflights13 датафреймов?
    -   Сколько строк в каждом датафрейме?
    -   Сколько столбцов в каждом датафрейме?
    -   Как просмотреть примерный вид датафрейма?
    -   Сколько компаний-перевозчиков (carrier) учитывают эти наборы данных (представлено в наборах данных)?
    -   Сколько рейсов принял аэропорт John F Kennedy Intl в мае?
    -   Какой самый северный аэропорт?
    -   Какой аэропорт самый высокогорный (находится выше всех над уровнем моря)?
    -   Какие бортовые номера у самых старых самолетов?
    -   Какая средняя температура воздуха была в сентябре в аэропорту John FKennedy Intl (в градусах Цельсия).
    -   Самолеты какой авиакомпании совершили больше всего вылетов в июне?
    -   Самолеты какой авиакомпании задерживались чаще других в 2013 году?
2.  Оценить результаты и сделать вывод

## Шаги:

### Шаг 1

#### 1. Установка и загрузка необходимых пакетов

```{r}
install.packages('nycflights13')
library(nycflights13)
library(dplyr)
```

#### Вопрос 1: Сколько встроенных в пакет nycflights13 датафреймов?

```{r}
package_data <- data(package = "nycflights13")
dataframes <- package_data$results[, "Item"]
length(dataframes)
```

#### Вопрос 2: Сколько строк в каждом датафрейме?

```{r}
nrow(airlines)

nrow(airports)

nrow(flights)

nrow(planes)

nrow(weather)
```

#### Вопрос 3: Сколько столбцов в каждом датафрейме?

```{r}
ncol(airlines)

ncol(airports)

ncol(flights)

ncol(planes)

ncol(weather)
```

#### Вопрос 4: Как просмотреть примерный вид датафрейма?

```{r}
head(airlines)
```

#### Вопрос 5: Сколько компаний-перевозчиков (carrier) учитывают эти наборы данных?

```{r}
length(unique(airlines$carrier))
```

#### Вопрос 6: Сколько рейсов принял аэропорт John F Kennedy Intl в мае?

```{r}
nrow(flights[flights$dest == "JFK" & flights$month == 5, ])
```

#### Вопрос 7: Какой самый северный аэропорт?

```{r}
top_airport <- airports[which.max(airports$lat), ]
selected_data <- top_airport[c("name", "lat")]
selected_data
```

#### Вопрос 8: Какой аэропорт самый высокогорный (находится выше всех над уровнем моря)?

```{r}
top_airport <- airports[which.max(airports$alt), ]
selected_data <- top_airport[c("name", "alt")]

selected_data <- top_airport[c("name", "alt")]
selected_data
```

#### Вопрос 9: Какие бортовые номера у самых старых самолетов?

```{r}
planes_no_na <- planes[!is.na(planes$year), ]

sorted_planes <- planes_no_na[order(planes_no_na$year), ]

top_10 <- sorted_planes[1:10, ]
result <- top_10[c("year", "tailnum")]
result
```

#### Вопрос 10: Какая средняя температура воздуха была в сентябре в аэропорту John F Kennedy Intl (в градусах Цельсия)?

```{r}
jfk_september <- weather[weather$origin == "JFK" & weather$month == 9, ]

mean_temp_f <- mean(jfk_september$temp, na.rm = TRUE)
mean_temp_c <- (mean_temp_f - 32) * 5/9
mean_temp_c
```

#### Вопрос 11: Самолеты какой авиакомпании совершили больше всего вылетов в июне?

```{r}
june_flights <- flights[flights$month == 6, ]
carrier_counts <- table(june_flights$carrier)
sorted_carriers <- sort(carrier_counts, decreasing = TRUE)
top_carrier <- names(sorted_carriers)[1]
count_value <- sorted_carriers[1]
airline_name <- airlines[airlines$carrier == top_carrier, "name"]
data.frame(name = airline_name, n = count_value)
```

#### Вопрос 12: Самолеты какой авиакомпании задерживались чаще других в 2013 году?

```{r}
complete_flights <- flights[!is.na(flights$dep_delay) & !is.na(flights$arr_delay), ]
complete_flights$delayed <- complete_flights$dep_delay > 0 | complete_flights$arr_delay > 0
carrier_stats <- aggregate(
    cbind(delayed_flights = delayed, total_flights = delayed/delayed) ~ carrier, 
    data = complete_flights, 
    FUN = function(x) if(is.logical(x)) sum(x) else length(x)
)
carrier_stats$delay_ratio <- carrier_stats$delayed_flights / carrier_stats$total_flights

carrier_stats <- carrier_stats[order(-carrier_stats$delay_ratio), ]

result <- merge(carrier_stats, airlines, by = "carrier", all.x = TRUE)
result
```

### Шаг 2

#### Оценка результатов

В ходе выполнения работы были успешно проанализированы наборы данных пакета `nycflights13` с использованием функций `dplyr` и базовых операций R.

#### Вывод

В результате выполнения "Практической работы №3" были закреплены навыки использования языка `R` и пакета `dplyr` для анализа реальных наборов данных о воздушных перевозках.
